#!/usr/bin/env python
import sys
import logging

from extractor.main import Extractor
from extractor.common import isValidhtml

def main():
    from optparse import OptionParser
    parser = OptionParser(usage="%prog: [options] [file]")
    parser.add_option('-u', '--url', help="use URL instead of a local file")
    parser.add_option('-d', action="store_true", dest="debug")
    (options, args) = parser.parse_args()

    if not options.url:
        parser.print_help()
        sys.exit(1)

    loglevel = logging.INFO
    if options.debug:
        loglevel = logging.DEBUG

    file = None
    if options.url:
        if not isValidhtml(options.url):
            print "Unrecognized URL, please provide a content-type of text/html"
            sys.exit(255)

        import urllib
        file = urllib.urlopen(options.url)
    else:
        file = open(args[0])
    try:
        content = file.read()
        try:
            import chardet
            enc = chardet.detect(content)['encoding']
            content = content.decode(enc)
        except:
            pass
        out = Extractor(content, loglevel=loglevel).extracted()
        print out.encode('utf-8','ignore')

    except Exception as err:
        print "Error in printing the extracted html () %s" % err

    finally:
        file.close()

if __name__ == '__main__':
    main()
